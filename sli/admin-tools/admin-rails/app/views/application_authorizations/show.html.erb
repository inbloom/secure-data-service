<p id="notice"><%= notice %></p>

<%  puts("The auth in here is " + @application_authorization.inspect); %>
<table>
  <tr>
    <th>Name</th>
    <th>Version</th>
    <th>Vendor</th>
    <th>Status</th>
    <th> </th>
  </tr>
<%
    apps = App.all
    authorizedApps = apps.select {|app| @application_authorization.appIds.find_index(app.id) != nil}
    unauthorizedApps = apps.select {|app| @application_authorization.appIds.find_index(app.id) == nil}
    apps = authorizedApps + unauthorizedApps
    apps.each do |app|
%>
    <tr>
      <td><%= app.name %></td>
      <td><%= app.version  %></td>
      <td><%= app.developer_info.organization %></td>
      <%=
          isApproved = false
          if @application_authorization.appIds.find_index(app.id) != nil
                isApproved = true
                content_tag(:td, "Approved", :id => "approvedStatus")
          else
                content_tag(:td, "Not Approved", :id => "notApprovedStatus")
          end
      %>
      <td><%=
          form_for @application_authorization do |f|
          %>
            <%= f.hidden_field :appId, :value => app.id %>
            <%= f.submit "Approve", :disabled => isApproved,
                         :confirm => "Do you really want this application to access the district's data?'" %>
            <%= f.submit "Deny", :disabled => !isApproved,
                :confirm => "Do you really want to deny the district's data to this application?"%>
          <%end
      %></td>
    </tr>
    <%end %>
  </table>
<%= link_to 'Back', application_authorizations_path %>
