<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:util="http://www.springframework.org/schema/util" xmlns:context="http://www.springframework.org/schema/context"
  xmlns:aop="http://www.springframework.org/schema/aop"
  xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">

  <import resource="transformation-context.xml" />

  <!-- Include resources from DAL -->
  <import resource="classpath:/spring/db.xml" />
  <import resource="dal-context.xml" />

  <!-- Used for new (plain and transformed) entities -->
  <bean id="entityPersistHandler" class="org.slc.sli.ingestion.handler.EntityPersistHandler">
    <property name="entityRepository" ref="mongoEntityRepository" />
    <property name="messageSource" ref="messageSource" />
  </bean>

  <!-- Used for old pipeline entities -->
  <bean id="obsoleteEntityPersistHandler" class="org.slc.sli.ingestion.handler.NeutralRecordEntityPersistHandler">
    <property name="entityRepository" ref="mongoEntityRepository" />
    <property name="messageSource" ref="messageSource" />
  </bean>

  <!-- Used for 'special' entities -->
  <util:map id="entityPersistHandlers" key-type="java.lang.String" value-type="org.slc.sli.ingestion.handler.AbstractIngestionHandler">
  </util:map>
  
  <!-- collections that should be persisted using the old pipeline -->
  <util:set id="oldPipelineEntities" set-class="java.util.HashSet" value-type="java.lang.String">
    <value>competencyLevelDescriptor</value>
    <value>graduationPlan</value>
    <value>learningStandard</value>
    <value>parent</value>
    <value>staff</value>
    <value>staffEducationOrganizationAssociation</value>
    <value>student</value>
    <value>studentParentAssociation</value>
    <value>studentSectionAssociation</value>
    <value>teacher</value>
  </util:set>

  <!-- collections that should be persisted using the new pipeline but no transformation has been performed -->
  <util:set id="newPipelinePlainEntities" set-class="java.util.HashSet" value-type="java.lang.String">
    <value>calendarDate</value>
    <value>cohort</value>
    <value>course</value>
    <value>courseOffering</value>
    <value>disciplineAction</value>
    <value>disciplineIncident</value>
    <value>educationOrganization</value>
    <value>grade</value>
    <value>gradebookEntry</value>
    <value>gradingPeriod</value>
    <value>localEducationAgency</value>
    <value>program</value>
    <value>reportCard</value>
    <value>school</value>
    <value>section</value>
    <value>session</value>
    <value>staffCohortAssociation</value>
    <value>staffProgramAssociation</value>
    <value>stateEducationAgency</value>
    <value>studentAcademicRecord</value>
    <value>studentCohortAssociation</value>
    <value>studentCompetency</value>
    <value>studentCompetencyObjective</value>
    <value>studentDisciplineIncidentAssociation</value>
    <value>studentProgramAssociation</value>
    <value>studentSchoolAssociation</value>
    <value>studentSectionGradebookEntry</value>
    <value>teacherSchoolAssociation</value>
    <value>teacherSectionAssociation</value>
  </util:set>

  <!-- collections that should be persisted using the new pipeline and a transformation has been performed. the collection
    to use will be <name>_transformed -->
  <util:set id="newPipelineTransformedEntities" set-class="java.util.HashSet" value-type="java.lang.String">
    <value>assessment</value>
    <value>attendance</value>
    <value>learningObjective</value>
    <value>studentAssessmentAssociation</value>    
    <value>studentTranscriptAssociation</value>
  </util:set>

  <!-- collections that only exist in the staging database because they are combined into a _transformed collection for another
    entity -->
  <util:set id="stagedOnlyEntities" set-class="java.util.HashSet" value-type="java.lang.String">
    <value>assessmentFamily</value>
    <value>assessmentItem</value>
    <value>assessmentPeriodDescriptor</value>
    <value>objectiveAssessment</value>
    <value>studentAssessmentItem</value>
    <value>studentObjectiveAssessment</value>
  </util:set>

  <util:map id="entityPersistTypeMap" key-type="java.lang.String" value-type="java.util.Set">
    <entry key="stagedOnlyEntities">
      <ref local="stagedOnlyEntities" />
    </entry>
    <entry key="oldPipelineEntities">
      <ref local="oldPipelineEntities" />
    </entry>
    <entry key="newPipelinePlainEntities">
      <ref local="newPipelinePlainEntities" />
    </entry>
    <entry key="newPipelineTransformedEntities">
      <ref local="newPipelineTransformedEntities" />
    </entry>
  </util:map>

</beans>
